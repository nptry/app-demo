import type { Request, Response } from 'express';

const siteData = {
  summary: {
    totalSites: 12,
    enabledSites: 10,
    totalAreaSqm: 680000,
  },
  sites: [
    {
      id: 'SITE-001',
      name: 'Ikeja 商业区核心广场',
      siteType: '公共场所',
      region: 'Ikeja · Allen 大道',
      address: 'Allen 大道 20-50 号',
      coordinates: '6.601839, 3.351486',
      areaSize: 13000,
      manager: 'Oluwaseun Ade',
      phone: '08012238899',
      plan: '已上传 (CBD-Plan-A.pdf)',
      description: 'CBD 核心片区，工作日人流 12 万人次',
      status: '启用',
    },
    {
      id: 'SITE-004',
      name: 'Balogun 北区市场',
      siteType: '商业区域',
      region: 'Lagos Island',
      address: 'Balogun 市场北入口',
      coordinates: '6.452772, 3.395870',
      areaSize: 8000,
      manager: 'Idris Ajayi',
      phone: '08052337611',
      plan: '平面图 (Balogun-North.png)',
      description: '重点关注扒窃、拥堵风险',
      status: '启用',
    },
    {
      id: 'SITE-006',
      name: 'Oshodi 枢纽天桥集群',
      siteType: '公共场所',
      region: 'Oshodi-Isolo',
      address: 'Oshodi BRT 枢纽',
      coordinates: '6.555303, 3.343987',
      areaSize: 6000,
      manager: 'Grace Nneka',
      phone: '08031157644',
      plan: '天桥平面图 (Oshodi-Bridge.pdf)',
      description: '全天候人流，重点防范踩踏',
      status: '启用',
    },
    {
      id: 'SITE-009',
      name: 'Tafawa Balewa 广场',
      siteType: '活动区域',
      region: 'Lagos Island',
      address: 'Awolowo 路 45 号',
      coordinates: '6.445912, 3.406210',
      areaSize: 5000,
      manager: 'Sara Yusuf',
      phone: '08037782288',
      plan: '平面图 (TBP-Event.jpg)',
      description: '大型活动举办地，本周举办音乐节',
      status: '启用',
    },
    {
      id: 'SITE-011',
      name: '政府办公区西门',
      siteType: '政府办公区',
      region: 'Alausa CBD',
      address: 'Governor Road 88 号',
      coordinates: '6.603210, 3.351100',
      areaSize: 4500,
      manager: 'Chinedu Lawson',
      phone: '08027719822',
      plan: 'WestGate.pdf',
      description: '目前处于施工，暂未监测',
      status: '禁用',
    },
  ],
};

const deploymentData = {
  deployments: [
    {
      id: 'DEP-001',
      siteId: 'SITE-001',
      siteName: 'Ikeja 商业区核心广场',
      zoneCode: 'SITE-001-Z01',
      zoneArea: 320,
      deviceType: '高清数字摄像机',
      deviceId: 'CAM-IKJ-01',
      deviceName: '广场东北角 Dome 摄像机',
      position: '东北角智慧灯杆顶部',
      installHeight: 3.2,
      installDate: '2024-02-18',
      owner: 'Oluwaseun Ade',
      status: '正常运行',
    },
    {
      id: 'DEP-002',
      siteId: 'SITE-001',
      siteName: 'Ikeja 商业区核心广场',
      zoneCode: 'SITE-001-Z01',
      zoneArea: 320,
      deviceType: 'AI 边缘计算设备',
      deviceId: 'AIE-IKJ-01',
      deviceName: '广场 AI 节点',
      position: '东北角灯杆箱体',
      installDate: '2024-02-18',
      owner: 'Oluwaseun Ade',
      status: '正常运行',
    },
    {
      id: 'DEP-006',
      siteId: 'SITE-004',
      siteName: 'Balogun 北区市场',
      zoneCode: 'SITE-004-Z02',
      zoneArea: 280,
      deviceType: '高清数字摄像机',
      deviceId: 'CAM-BAL-05',
      deviceName: '北区东入口相机',
      position: '入口 5m 灯杆',
      installHeight: 3.5,
      installDate: '2024-03-05',
      owner: 'Idris Ajayi',
      status: '待调试',
    },
  ],
};

const densityData = {
  metrics: {
    alertCount: 4,
    highDensityZones: 3,
    lastSync: '2024-05-09 10:45',
  },
  records: [
    {
      id: 'DEN-001',
      siteId: 'SITE-004',
      siteName: 'Balogun 北区市场',
      zoneCode: 'SITE-004-Z02',
      zoneArea: 65,
      time: '2024-05-09 10:44:12',
      density: 0.92,
      totalPeople: 60,
      threshold: 0.8,
      trend: [
        { time: '10:00', density: 0.78 },
        { time: '10:10', density: 0.83 },
        { time: '10:20', density: 0.88 },
        { time: '10:30', density: 0.90 },
        { time: '10:40', density: 0.92 },
      ],
      alarm: {
        triggered: true,
        triggeredAt: '2024-05-09 10:32',
        receiver: 'Idris Ajayi',
        status: '处理中',
        remark: '现场引导设置单向通行',
      },
      sourceDeviceId: 'AIE-BAL-01',
      confidence: 0.93,
    },
    {
      id: 'DEN-005',
      siteId: 'SITE-001',
      siteName: 'Ikeja 商业区核心广场',
      zoneCode: 'SITE-001-Z01',
      zoneArea: 80,
      time: '2024-05-09 10:42:02',
      density: 0.55,
      totalPeople: 44,
      threshold: 0.7,
      trend: [
        { time: '10:00', density: 0.40 },
        { time: '10:10', density: 0.48 },
        { time: '10:20', density: 0.52 },
        { time: '10:30', density: 0.56 },
      ],
      alarm: {
        triggered: false,
      },
      sourceDeviceId: 'AIE-IKJ-01',
      confidence: 0.96,
    },
  ],
};

const flowData = {
  metrics: {
    totalFlows: 1280,
    abnormalEvents: 2,
    lastSync: '2024-05-09 10:40',
  },
  records: [
    {
      id: 'FLOW-001',
      siteId: 'SITE-001',
      siteName: 'Ikeja 商业区核心广场',
      zoneCode: 'SITE-001-Z01',
      direction: '东→西',
      time: '2024-05-09 10:30:00',
      forwardFlow: 320,
      reverseFlow: 0,
      totalFlow: 320,
      threshold: 350,
      abnormal: false,
      suggestion: '保持现有引导',
      deviceId: 'AIE-IKJ-01',
      accuracy: 0.9,
    },
    {
      id: 'FLOW-005',
      siteId: 'SITE-004',
      siteName: 'Balogun 北区市场',
      zoneCode: 'SITE-004-Z03',
      direction: '双向',
      time: '2024-05-09 10:20:00',
      forwardFlow: 180,
      reverseFlow: 210,
      totalFlow: 390,
      threshold: 320,
      abnormal: true,
      duration: '15 分钟',
      suggestion: '暂停西向入口 5 分钟，分流至南向',
      deviceId: 'AIE-BAL-02',
      accuracy: 0.88,
    },
  ],
};

const targetData = {
  metrics: {
    watchlistCount: 48,
    hitsToday: 3,
    activeAlarms: 1,
    lastPush: '2024-05-09 10:15',
  },
  records: [
    {
      id: 'TAR-001',
      siteId: 'SITE-004',
      siteName: 'Balogun 北区市场',
      zoneCode: 'SITE-004-Z02',
      watchlistId: 'PER-KEY-001',
      time: '2024-05-09 09:58:31',
      personId: 'PER-KEY-001',
      personName: 'Grace Obi',
      personType: '重点关注人员',
      behavior: '区域内徘徊 6 分钟',
      alarm: {
        triggered: true,
        channels: ['短信', '系统通知'],
        receiver: 'Idris Ajayi',
        status: '处理中',
        remark: '安保前往核查身份',
      },
      deviceId: 'AIE-BAL-01',
      accuracy: 0.94,
    },
    {
      id: 'TAR-003',
      siteId: 'SITE-006',
      siteName: 'Oshodi 枢纽天桥集群',
      zoneCode: 'SITE-006-Z03',
      watchlistId: 'PER-KEY-004',
      time: '2024-05-09 08:45:11',
      personId: '无',
      personName: '未知',
      personType: '未匹配',
      behavior: '携带大件物品通过',
      alarm: {
        triggered: false,
      },
      deviceId: 'AIE-OSH-01',
      accuracy: 0.86,
    },
  ],
};

export default {
  'GET /api/key-area/sites': (req: Request, res: Response) => {
    res.json({ success: true, data: siteData });
  },
  'GET /api/key-area/deployments': (req: Request, res: Response) => {
    res.json({ success: true, data: deploymentData });
  },
  'GET /api/key-area/density': (req: Request, res: Response) => {
    res.json({ success: true, data: densityData });
  },
  'GET /api/key-area/flow': (req: Request, res: Response) => {
    res.json({ success: true, data: flowData });
  },
  'GET /api/key-area/targets': (req: Request, res: Response) => {
    res.json({ success: true, data: targetData });
  },
};
